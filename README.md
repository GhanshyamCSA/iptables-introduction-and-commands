# iptables-introduction-and-commands
### iptables- A linux firewall tool

               Most used iptables commands


In this article you will see some useful commands for linux iptables.but before directly using the commands let’s learn what iptables is and what it does.

What is iptables?

According to iptables manual this is the description of iptables 
“Iptables and ip6tables are used to set up, maintain, and inspect the tables of IPv4 and IPv6 packet filter rules in the Linux kernel.Several different tables may be defined.Each table contains a number of built-in chains and may also contain user-defined chains.
Each chain is a list of rules which can match a set of packets.Each rule specifies what to do with a packet that matches.This is called a `target', which may be a jump to a user-defined chain in the same table.”
All-in-all we can say iptables is a linux tool which works like a host based firewall where we can define some rules based on which we allow(Accept) or prohibit(Drop,Return) a packet to access  the target host.rules can be defined in several different tables and each table has some built in chains along with a user can also define its own chain.

![FW-IDS-iptables-Flowchart-v2019-04-30-1](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/94803c62-5fbf-49e7-a97e-68ed2a5470cb)

* credit - thanks Phil Hagen and SANS for above flowchart 

there are currently five independent tables(depends on kernel configuration) 


1.Filter- this is the default table. It contains below built-in chains
INPUT - packets destined to local sockets
FORWARD - for packets being routed through the box
OUTPUT - for locally generated packets

2.NAT- this table is consulted when a packet that creates a new connection is encountered. It has below built-in chains
PREROUTING - for altering packets as soon as they come in
INPUT - for altering packets destined for local sockets
OUTPUT - for altering locally generated packets before routing
POSTROUTING - for altering packets as they ready to go out 

3.Mangle- this table is used for specialized packet alteration. Now it contains below built-in chains
PREROUTING - for altering incoming packets before routing
INPUT - for packets coming into box itself
FORWARD - for altering packets being routed through the box 
OUTPUT - for locally generated packets before routing
POSTROUTING - for altering packets as they are about to go out

4.Raw- this table is used mainly for configuring exemption from tracking.it contains below built-in chains
PREROUTING - for packets coming via any interface
OUTPUT - for packets generated by local processes

5.Security- this table is used for mandatory access control networking rules.it has three built-in chains
INPUT - for incoming packets
OUTPUT - for altering locally generated packets
FORWARD - for altering packets being routed through the box
![p7x5T](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/b1d2c03f-4176-476d-ab14-6ffa429477c3)


Accept,Drop and Return
Accept does what it means, it lets through the packets.Drop and Return are two different states to reject the packets to the target either ingress or egress.Drop rejects packets silently without any message.Return means stop traversing in the given chain and resume at the next rule in previous chain.

Enough of theory and description, let’s dig into the practicals…

1.To check all iptables rules

If you want to check your existing rules, use the command 
$ sudo iptables  -L  -n  -v

(-L -> lists all the rules in the selected chain chain, -n = numeric , -v = verbose)
![0 (1)](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/8c5870c7-34d7-40a8-97d4-03883b36ef0b)


If you want to check in specific table
$ sudo iptables  -t  [ table name]  -L -n -v

![0 (2)](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/d2d15dde-bbe4-4425-b571-ddafb96c64c3)


2.Adding a rule

Because iptables rules are read from top to bottom, this factor can become an issue if conflicting rules are read in the wrong order.
There are two ways to add rules in iptables.one is to append with option -A, second is insert with option  -I. Append puts the rule at the bottom of the list, on the contrary insert option puts the rules at the top of the list.so if anyone is certain that the particular rule should be at the bottom of the list then only one should use append , in all other cases one should use only insert option to ensure that rules like DENY ALL does not overshadow rules below it

$ sudo iptables  -A  INPUT -j DROP
( -j [ jump ] = specifies the action to the target if packet matches the rule, -A = to append a rule )
![0 (3)](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/205f8910-9222-435d-8c68-377095808280)

$ sudo iptables -I INPUT -j ACCEPT
Or 
$ sudo iptables -I INPUT  -j DROP
( -I = to insert a rule )

3.Deleting a rule
$ sudo iptables  -D INPUT [ rule no ]
Or 
$ sudo iptables  - -delete INPUT 1
( -D / - - delete = to delete )
![0 (4)](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/d2aabd10-300d-4a0a-a6f2-70cf1a4edf90)

4.To search a specific value/string within iptables
$ sudo iptables  -L  [ table name ]   -n   -v  | grep [ search value/string ]
![0 (5)](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/13efc815-2a44-479e-b18c-cfd326cb4ab2)



5.To block specific ip address
$ sudo iptables -A INPUT  -s [ IP Address ]  -j  DROP
( -s / - -src = source address)
![0 (6)](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/5ccce197-22ac-47c8-ab24-01ee78e61e5c)
![0 (7)](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/f4ea2bd3-2258-44c7-b309-a80ef493e687)



6.To block specific protocol of a given IP
$ sudo iptables  -I INPUT -d [ IP Address ]  -p [ Protocol ]  -j DROP
(-p = protocol)
![0 (8)](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/d51df1ec-b5b9-4fae-a022-1a662b2575f1)


7.To block incoming connection on specific port
$ sudo  -A INPUT  -s [ IP Address ]   - -dport [ destination port]  -j DROP
( - -dport = destination port )
![0 (9)](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/58ed0343-5289-4086-ba37-4b095ebeec2a)
![0 (11)](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/3d813f1b-f260-4948-b0c3-3757f7988f33)


8.To check if a specific rule is present in the chain or  not
$ sudo iptables  -t  Filter  -C INPUT -s [ IP Address ]  -j  DROP
(-C / - -check = to check )
![0 (14)](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/a04261b6-4c37-4952-845d-d9d75b7b91bb)


9.To Allow multiple ports
$ sudo iptables  -A OUTPUT  -p tcp  -m multiport   - -sport 20,21,25  -j  ACCEPT
![0 (15)](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/25c93b39-f31e-465c-b943-8a62df2dc999)


10.To setup port forwarding
$ iptables  -t  nat  -A   PREROUTING   -i  eth0  -p  tcp  - -dport  [port number ]   -j  REDIRECT                 - -to-port  [ port number]
![0 (16)](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/8c08776e-47a5-4696-a6ef-4ac01dcc01c7)



11.To allow specific network range
$ sudo iptables  -A OUTPUT -p tcp  -d 192.168.1.0/24  -dport 22  -j ACCEPT
(-d = destination)
#expected 

12.To block incoming ping request
$  sudo iptables  -A  INPUT  -p  icmp   -i   eth0  -j DROP
( -i =  in-interface to which the in-flow is coming )
![0 (18)](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/61c00a3c-a253-4ff6-991b-2327095f3514)


13.to allow Loopback access
It is important to leave loopback active.

$ sudo iptables  -A INPUT -i  lo   -j  ACCEPT 
$ sudo iptables  -A  OUTPUT   -o  lo   -j  ACCEPT 
( -o = out-interface from where the out-flow is going )
![0 (19)](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/95b475fc-d936-49ad-85a3-47424a1917d2)



14.To block access to specific mac address 
$ sudo iptables  -A   INPUT  -m   mac  - -mac-source  [ mac address ]  -j   DROP
(-m = matches )
![0 (21)](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/164f483b-4758-4743-b38f-28c8f43d06fd)


15.To block a site 
Find the network range  of the site. And then block the network range of that site.
 
$ sudo iptables  -A  OUTPUT  -p  tcp  -d  [ IP/CIDR OF SITE ]  -j  DROP
![0 (24)](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/7a2ee1ca-1c9e-4209-87bf-b59cfb789a2f)
![0 (23)](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/269c76c3-557d-45d2-994a-51722aafeb33)
![0 (22)](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/cd6878a5-585f-4794-bc2f-723adf9b53aa)


16.Logging of dropped packets by iptables
$ sudo iptables -A INPUT  -i  eth0 -j  LOG  - - log-prefix   “[file name]”
![0 (25)](https://github.com/GhanshyamCSA/iptables-introduction-and-commands/assets/7269200/8097ce7e-6acb-42c6-8e23-aa433de26d61)



Persistence
By default, iptables rules are not persistent, which means they won't survive a system reboot. To make your rules permanent, consider using a tool like iptables-persistent (Debian/Ubuntu) or firewalld (Red Hat-based systems) to save and load rules automatically.


Conclusion
There are many more commands to explore. The idea of this article is to make  you familiar with the most necessary and useful linux system administration tool.Configuring iptables is straightforward and typically demands minimal upkeep. Unlike some firewall solutions, it doesn't necessitate frequent daemon restarts. Moreover, iptables is readily accessible on all Linux distributions. When launching a fresh Linux system, one of the initial steps you ought to consider is establishing these fundamental rules. It's crucial to preempt any security concerns from emerging during the system's early deployment stages.
